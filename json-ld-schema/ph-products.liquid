{%- comment -%}
  Parameters:
  - product {Object} - Product object.

  Usage:
  {% render 'structured-data-product', product: product %}

  <script type="application/ld+json">
  {{ product | structured_data }}
</script>
{%- endcomment -%}



{% assign current_variant = product.selected_or_first_available_variant %}
{% assign variant_image_url = current_variant.image | image_url: width: 1920 %}
{% assign variant_image_url_full = 'https:' | append: variant_image_url %}

{%- assign has_variants = false -%}
{%- if product.variants.size > 1 -%}
  {%- assign has_variants = true -%}
{%- endif -%}

<script type="application/ld+json">
{
  "@context": "http://schema.org/",
  "@type": {% if has_variants %}"ProductGroup"{% else %}"Product"{% endif %},
  "@id": "{{ shop.url }}{{ product.url }}",
  "category": {{ product.type | json }},
  "description": {{ product.description | strip_html | json }},
  "gtin": {{ current_variant.barcode | json }},
  "image": {{ variant_image_url_full | json}},
  "name": {{ product.title  | json }},
  "sku": "{{ current_variant.sku }}",
  "url": {{ canonical_url | json }},
  "brand": {
    "@type": "Brand",
    "name": {{ product.vendor | json }}
  }, {% unless has_variants %}
  "offers": {
    "@id": {{ canonical_url | append: '?variant=' | append: current_variant.id | append: '#offer' | json }},
    "@type": "Offer",
    "availability": "http://schema.org/InStock",
    "price": {{ current_variant.price | money_without_currency | json }},
    "priceCurrency": "{{ cart.currency.iso_code }}",
    "url": {{ canonical_url | append: '?variant=' | append: current_variant.id | json }}
  } {% endunless %}

    {% if has_variants %}
    "productGroupID": {{ product.id | json }},
    "hasVariant": [
    {%- for variant in product.variants -%}
        {%- assign v_img = variant.image | default: product.featured_image -%}
        {%- assign v_img_path = v_img | image_url: width: 1920 -%}
        {%- assign v_img_full = 'https:' | append: v_img_path -%}
      {
        "@id": {{ shop.url | append: variant.url | append: '#variant' | json }},
        "@type": "Product",
        "sku": {{ variant.sku | json }},
        "gtin": {{ variant.barcode | json }},
        "name": {{ variant.title | json }},
        "image": {{ v_img_full | json }},
        "offers": {
          "@id": {{ shop.url | append: variant.url | append: '#offer' | json }},
          "@type": "Offer",
          "price": {{ variant.price | money_without_currency }},
          "priceCurrency": {{ cart.currency.iso_code | json }},
          "availability": "https://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}",
          "url": {{ shop.url | append: variant.url | json }}
        }
      }{% unless forloop.last %},{% endunless %}
    {%- endfor -%}
  ]
  {% endif %}
}
</script>
