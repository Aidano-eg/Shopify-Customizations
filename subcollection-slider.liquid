{% doc %}
  @prompt
    Build a section for collection pages that:
    
    Reads collection.metafields.custom.category_group.value
    
    Loops entry.sub_collections.value (Reference â†’ List of Collections)
    
    Renders a horizontal slider of those collections with square images (1:1, center crop), title under image, effect on hover, border radius 0, 12px gap between cards, full width. The arrows should only display on hover and should not be cut off.
    
    Settings: heading text, heading alignment, item limit, show arrows, hide on mobile, gap between cards
    
    If metafield or list is empty, render nothing, Ad setting to align the collection name under the card (left, center, right)
    Change the size of the collection images to 185px tall, 205 px wide, The slider control arrow is being cut off, it needs to be move in overlapping the collection card enough that the entire component is visible. Add a setting to change the color/style of the arrow as well
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% liquid
  assign category_group = collection.metafields.custom.category_group.value
  assign sub_collections = category_group.sub_collections.value
  
  if sub_collections == blank or sub_collections.size == 0
    echo ''
  endif
%}

{% if sub_collections != blank and sub_collections.size > 0 %}
  {% style %}
    .ai-collection-slider-{{ ai_gen_id }} {
      width: 100%;
      overflow: hidden;
      position: relative;
    }

    .ai-collection-slider__header-{{ ai_gen_id }} {
      margin-bottom: 24px;
    }

    .ai-collection-slider__heading-{{ ai_gen_id }} {
      margin: 0;
      color: {{ settings.heading_color }};
      text-align: {{ block.settings.heading_alignment }};
    }

    .ai-collection-slider__wrapper-{{ ai_gen_id }} {
      position: relative;
      max-width: 1590px;
      margin-left: auto;
      margin-right: auto;
    }

    .ai-collection-slider__track-{{ ai_gen_id }} {
      display: flex;
      gap: {{ block.settings.card_gap }}px;
      overflow-x: auto;
      scroll-behavior: smooth;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .ai-collection-slider__track-{{ ai_gen_id }}::-webkit-scrollbar {
      display: none;
    }

    .ai-collection-slider__item-{{ ai_gen_id }} {
      flex: 0 0 auto;
      width: 205px;
    }

    .ai-collection-slider__link-{{ ai_gen_id }} {
      display: block;
      text-decoration: none;
      color: inherit;
    }

    .ai-collection-slider__image-wrapper-{{ ai_gen_id }} {
      position: relative;
      width: 205px;
      height: 185px;
      overflow: hidden;
      border-radius: 0;
      background-color: #f4f4f4;
      margin-bottom: 12px;
    }

    .ai-collection-slider__image-{{ ai_gen_id }} {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .ai-collection-slider__link-{{ ai_gen_id }}:hover .ai-collection-slider__image-{{ ai_gen_id }} {
      transform: scale(1.05);
      opacity: 0.9;
    }

    .ai-collection-slider__title-{{ ai_gen_id }} {
      font-size: 16px;
      font-weight: 600;
      text-align: {{ block.settings.title_alignment }};
      margin: 0;
      color: {{ settings.heading_color }};
    }

    .ai-collection-slider__nav-{{ ai_gen_id }} {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 2;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    {% if block.settings.show_arrows %}
      .ai-collection-slider__wrapper-{{ ai_gen_id }}:hover .ai-collection-slider__nav-{{ ai_gen_id }} {
        opacity: 1;
        pointer-events: auto;
      }
    {% endif %}

    .ai-collection-slider__nav-{{ ai_gen_id }}--prev {
      left: 10px;
    }

    .ai-collection-slider__nav-{{ ai_gen_id }}--next {
      right: 10px;
    }

    .ai-collection-slider__nav-button-{{ ai_gen_id }} {
      width: 44px;
      height: 44px;
      border-radius: {% if block.settings.arrow_style == 'circle' %}50%{% else %}8px{% endif %};
      background-color: {{ block.settings.arrow_background_color }};
      color: {{ block.settings.arrow_icon_color }};
      border: {% if block.settings.arrow_style == 'outline' %}2px solid {{ block.settings.arrow_icon_color }}{% else %}none{% endif %};
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .ai-collection-slider__nav-button-{{ ai_gen_id }}:hover {
      {% if block.settings.arrow_style == 'outline' %}
        background-color: {{ block.settings.arrow_icon_color }};
        color: {{ block.settings.arrow_background_color }};
      {% else %}
        opacity: 0.8;
        transform: scale(1.05);
      {% endif %}
    }

    .ai-collection-slider__nav-button-{{ ai_gen_id }} svg {
      width: 20px;
      height: 20px;
    }

    @media screen and (max-width: 749px) {
      {% if block.settings.hide_on_mobile %}
        .ai-collection-slider-{{ ai_gen_id }} {
          display: none;
        }
      {% endif %}

      .ai-collection-slider__item-{{ ai_gen_id }} {
        width: 160px;
      }

      .ai-collection-slider__image-wrapper-{{ ai_gen_id }} {
        width: 160px;
        height: 145px;
      }

      .ai-collection-slider__nav-{{ ai_gen_id }} {
        display: none;
      }
    }
  {% endstyle %}

  <collection-slider-{{ ai_gen_id }} class="ai-collection-slider-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
    {% if block.settings.heading != blank %}
      <div class="ai-collection-slider__header-{{ ai_gen_id }}">
        <h2 class="ai-collection-slider__heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
      </div>
    {% endif %}

    <div class="ai-collection-slider__wrapper-{{ ai_gen_id }}">
      {% if block.settings.show_arrows %}
        <div class="ai-collection-slider__nav-{{ ai_gen_id }} ai-collection-slider__nav-{{ ai_gen_id }}--prev">
          <button
            class="ai-collection-slider__nav-button-{{ ai_gen_id }}"
            aria-label="Previous"
            data-direction="prev"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
        </div>
      {% endif %}

      <div class="ai-collection-slider__track-{{ ai_gen_id }}" data-slider-track>
        {% liquid
          assign item_limit = block.settings.item_limit
          if item_limit == 0
            assign item_limit = sub_collections.size
          endif
        %}

        {% for sub_collection in sub_collections limit: item_limit %}
          <div class="ai-collection-slider__item-{{ ai_gen_id }}">
            <a href="{{ sub_collection.url }}" class="ai-collection-slider__link-{{ ai_gen_id }}">
              <div class="ai-collection-slider__image-wrapper-{{ ai_gen_id }}">
                {% if sub_collection.featured_image %}
                  <img
                    src="{{ sub_collection.featured_image | image_url: width: 410 }}"
                    alt="{{ sub_collection.featured_image.alt | escape }}"
                    width="410"
                    height="370"
                    loading="lazy"
                    class="ai-collection-slider__image-{{ ai_gen_id }}"
                  >
                {% else %}
                  <div class="ai-collection-slider__image-placeholder-{{ ai_gen_id }}">
                    {{ 'collection-1' | placeholder_svg_tag }}
                  </div>
                {% endif %}
              </div>
              <h3 class="ai-collection-slider__title-{{ ai_gen_id }}">{{ sub_collection.title }}</h3>
            </a>
          </div>
        {% endfor %}
      </div>

      {% if block.settings.show_arrows %}
        <div class="ai-collection-slider__nav-{{ ai_gen_id }} ai-collection-slider__nav-{{ ai_gen_id }}--next">
          <button
            class="ai-collection-slider__nav-button-{{ ai_gen_id }}"
            aria-label="Next"
            data-direction="next"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>
      {% endif %}
    </div>
  </collection-slider-{{ ai_gen_id }}>

  <script>
    (function() {
      class CollectionSlider{{ ai_gen_id }} extends HTMLElement {
        constructor() {
          super();
          this.track = this.querySelector('[data-slider-track]');
          this.prevButton = this.querySelector('[data-direction="prev"]');
          this.nextButton = this.querySelector('[data-direction="next"]');
        }

        connectedCallback() {
          if (this.prevButton && this.nextButton) {
            this.prevButton.addEventListener('click', () => this.scroll('prev'));
            this.nextButton.addEventListener('click', () => this.scroll('next'));
          }
        }

        scroll(direction) {
          if (!this.track) return;

          const scrollAmount = this.track.offsetWidth * 0.8;
          const currentScroll = this.track.scrollLeft;

          if (direction === 'prev') {
            this.track.scrollTo({
              left: currentScroll - scrollAmount,
              behavior: 'smooth'
            });
          } else {
            this.track.scrollTo({
              left: currentScroll + scrollAmount,
              behavior: 'smooth'
            });
          }
        }
      }

      customElements.define('collection-slider-{{ ai_gen_id }}', CollectionSlider{{ ai_gen_id }});
    })();
  </script>
{% endif %}

{% schema %}
{
  "name": "Sub-collection slider",
  "tag": null,
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop by Category"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Heading alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left"
    },
    {
      "type": "select",
      "id": "title_alignment",
      "label": "Collection name alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "item_limit",
      "min": 0,
      "max": 20,
      "step": 1,
      "label": "Item limit",
      "default": 0,
      "info": "Set to 0 to show all items"
    },
    {
      "type": "header",
      "content": "Navigation arrows"
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "Show arrows",
      "default": true
    },
    {
      "type": "select",
      "id": "arrow_style",
      "label": "Arrow style",
      "options": [
        {
          "value": "circle",
          "label": "Circle"
        },
        {
          "value": "square",
          "label": "Square"
        },
        {
          "value": "outline",
          "label": "Outline"
        }
      ],
      "default": "circle"
    },
    {
      "type": "color",
      "id": "arrow_background_color",
      "label": "Arrow background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "arrow_icon_color",
      "label": "Arrow icon",
      "default": "#2a2b2a"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "checkbox",
      "id": "hide_on_mobile",
      "label": "Hide on mobile",
      "default": false
    },
    {
      "type": "range",
      "id": "card_gap",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "label": "Gap between cards",
      "default": 12
    }
  ],
  "presets": [
    {
      "name": "Sub-collection slider"
    }
  ]
}
{% endschema %}
